<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Avaliação Audiológica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .audiogram-grid {
            stroke: #e5e7eb;
            stroke-width: 1;
        }
        .audiogram-text {
            font-size: 10px;
            fill: #374151;
        }
        /* Estilos específicos para impressão */
        @media print {
            body { background: white; padding: 0; }
            .shadow-lg { box-shadow: none; }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="bg-gray-50 p-4 font-sans text-gray-800">

    <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden border border-gray-200">
        
        <!-- Cabeçalho -->
        <div class="bg-slate-800 text-white p-6">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-2xl font-bold uppercase tracking-wider">Avaliação Audiológica</h1>
                    <p class="text-sm opacity-80 mt-1">Clínica de Fonoaudiologia</p>
                </div>
                <div class="text-right text-xs opacity-80">
                    <p>Data: 24/05/2024</p>
                    <p>Ref: #8921-OD</p>
                </div>
            </div>
            
            <div class="mt-6 border-t border-slate-600 pt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <p><span class="font-semibold text-slate-400">Paciente:</span> Sr. João da Silva</p>
                    <p><span class="font-semibold text-slate-400">Idade:</span> 69 Anos</p>
                </div>
                <div>
                    <p><span class="font-semibold text-slate-400">Histórico:</span> Pós-op Mastoidectomia Radical (OD).</p>
                    <p><span class="font-semibold text-slate-400">Queixa:</span> Otorreia fétida (OD), Hipoacusia, Tontura.</p>
                </div>
            </div>
        </div>

        <!-- Área dos Audiogramas e Mascaramento -->
        <div class="p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 border-l-4 border-slate-800 pl-3">Audiometria Tonal Limiar</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-4">
                
                <!-- Orelha Direita -->
                <div class="flex flex-col items-center">
                    <div class="flex items-center gap-2 mb-2">
                        <h3 class="text-lg font-bold text-red-600">Orelha Direita (OD)</h3>
                        <span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded">Mascarada</span>
                    </div>
                    
                    <canvas id="canvasOD" width="350" height="350" class="border border-gray-300 bg-white shadow-sm mb-4"></canvas>
                    
                    <!-- Tabela Mascaramento OD -->
                    <table class="w-full text-xs text-center border-collapse">
                        <tr class="bg-gray-100 text-gray-600">
                            <td class="p-1 border text-left font-semibold w-20">Freq (Hz)</td>
                            <td class="p-1 border">500</td>
                            <td class="p-1 border">1k</td>
                            <td class="p-1 border">2k</td>
                            <td class="p-1 border">3k</td>
                            <td class="p-1 border">4k</td>
                        </tr>
                        <tr>
                            <td class="p-1 border text-left font-semibold text-red-600">Masc. VA (dB)</td>
                            <td class="p-1 border">40</td>
                            <td class="p-1 border">45</td>
                            <td class="p-1 border">50</td>
                            <td class="p-1 border">50</td>
                            <td class="p-1 border">55</td>
                        </tr>
                        <tr>
                            <td class="p-1 border text-left font-semibold text-red-600">Masc. VO (dB)</td>
                            <td class="p-1 border">45</td>
                            <td class="p-1 border">50</td>
                            <td class="p-1 border">50</td>
                            <td class="p-1 border">-</td>
                            <td class="p-1 border">60</td>
                        </tr>
                    </table>
                    <div class="mt-2 text-xs text-gray-500 w-full text-left">
                        <span class="mr-2"><span class="text-red-600 font-bold text-base">△</span> = VA Mascarada</span>
                        <span><span class="text-red-600 font-bold text-base">[</span> = VO Mascarada</span>
                    </div>
                </div>

                <!-- Orelha Esquerda -->
                <div class="flex flex-col items-center">
                    <div class="flex items-center gap-2 mb-2">
                        <h3 class="text-lg font-bold text-blue-600">Orelha Esquerda (OE)</h3>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded">VO Mascarada</span>
                    </div>
                    
                    <canvas id="canvasOE" width="350" height="350" class="border border-gray-300 bg-white shadow-sm mb-4"></canvas>
                    
                    <!-- Tabela Mascaramento OE -->
                    <table class="w-full text-xs text-center border-collapse">
                        <tr class="bg-gray-100 text-gray-600">
                            <td class="p-1 border text-left font-semibold w-20">Freq (Hz)</td>
                            <td class="p-1 border">500</td>
                            <td class="p-1 border">1k</td>
                            <td class="p-1 border">2k</td>
                            <td class="p-1 border">3k</td>
                            <td class="p-1 border">4k</td>
                        </tr>
                        <tr>
                            <td class="p-1 border text-left font-semibold text-blue-600">Masc. VA (dB)</td>
                            <td class="p-1 border">-</td>
                            <td class="p-1 border">-</td>
                            <td class="p-1 border">-</td>
                            <td class="p-1 border">-</td>
                            <td class="p-1 border">-</td>
                        </tr>
                        <tr>
                            <td class="p-1 border text-left font-semibold text-blue-600">Masc. VO (dB)</td>
                            <td class="p-1 border">50</td>
                            <td class="p-1 border">45</td>
                            <td class="p-1 border">55</td>
                            <td class="p-1 border">60</td>
                            <td class="p-1 border">60</td>
                        </tr>
                    </table>
                     <div class="mt-2 text-xs text-gray-500 w-full text-left">
                        <span class="mr-2"><span class="text-blue-600 font-bold text-base">X</span> = VA (s/ masc)</span>
                        <span><span class="text-blue-600 font-bold text-base">]</span> = VO Mascarada</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logoaudiometria Detalhada -->
        <div class="p-6 bg-gray-50 border-t border-gray-200">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-l-4 border-slate-800 pl-3">Logoaudiometria</h2>
            
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left border-collapse bg-white shadow-sm">
                    <thead>
                        <tr class="bg-slate-700 text-white">
                            <th class="p-2 border border-slate-600">Teste</th>
                            <th class="p-2 border border-slate-600 bg-red-700 text-center" colspan="3">Orelha Direita (OD)</th>
                            <th class="p-2 border border-slate-600 bg-blue-700 text-center" colspan="3">Orelha Esquerda (OE)</th>
                        </tr>
                        <tr class="bg-gray-100 text-xs font-semibold text-gray-700 text-center">
                            <th class="p-2 border">Tipo</th>
                            <th class="p-2 border">Intensidade</th>
                            <th class="p-2 border">Mascaramento</th>
                            <th class="p-2 border">% Acertos</th>
                            <th class="p-2 border">Intensidade</th>
                            <th class="p-2 border">Mascaramento</th>
                            <th class="p-2 border">% Acertos</th>
                        </tr>
                    </thead>
                    <tbody class="text-center">
                        <tr>
                            <td class="p-2 border font-bold text-left">SRT</td>
                            <td class="p-2 border">50 dB NA</td>
                            <td class="p-2 border text-gray-500">-</td>
                            <td class="p-2 border bg-gray-50">Limiar</td>
                            <td class="p-2 border">40 dB NA</td>
                            <td class="p-2 border text-gray-500">-</td>
                            <td class="p-2 border bg-gray-50">Limiar</td>
                        </tr>
                        <tr>
                            <td class="p-2 border font-bold text-left">IPRF (Mono)</td>
                            <td class="p-2 border font-bold text-red-600">90 dB NA</td>
                            <td class="p-2 border text-red-600 font-semibold">60 dB (OE)</td>
                            <td class="p-2 border font-bold">88%</td>
                            <td class="p-2 border font-bold text-blue-600">80 dB NA</td>
                            <td class="p-2 border text-blue-600 font-semibold">55 dB (OD)</td>
                            <td class="p-2 border font-bold">100%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="mt-2 text-xs text-gray-500 italic">* Mascaramento utilizado: Speech Noise. Valores de mascaramento calculados com base no método Plateau/Hood.</p>
        </div>

        <!-- Imitanciometria -->
        <div class="p-6 border-t border-gray-200">
             <h2 class="text-xl font-bold text-gray-800 mb-4 border-l-4 border-slate-800 pl-3">Imitanciometria</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Gráficos -->
                 <div class="flex flex-col items-center">
                    <canvas id="canvasTympOD" width="300" height="150" class="border border-gray-300 bg-white mb-2"></canvas>
                    <p class="text-xs font-bold text-red-600">OD: Curva Aberta (Volume Alto)</p>
                 </div>
                 <div class="flex flex-col items-center">
                    <canvas id="canvasTympOE" width="300" height="150" class="border border-gray-300 bg-white mb-2"></canvas>
                    <p class="text-xs font-bold text-blue-600">OE: Curva Tipo B (Líquido)</p>
                 </div>
             </div>
             
             <div class="mt-4 grid grid-cols-2 gap-4 text-sm bg-gray-50 p-4 rounded">
                <div>
                    <span class="font-bold text-red-600">Reflexos OD:</span> Ausentes
                </div>
                <div>
                    <span class="font-bold text-blue-600">Reflexos OE:</span> Ausentes
                </div>
             </div>
        </div>

        <!-- Laudo Final -->
        <div class="p-6 border-t-2 border-gray-300 bg-yellow-50">
            <h3 class="text-lg font-bold text-gray-900 mb-3 uppercase">Conclusão Diagnóstica</h3>
            
            <div class="mb-4 pl-4 border-l-4 border-red-500">
                <h4 class="font-bold text-red-800">Orelha Direita (OD)</h4>
                <p class="text-gray-800"><strong>Perda Auditiva Mista de Grau Moderado.</strong></p>
                <p class="text-sm text-gray-600 mt-1">Curva timpanométrica compatível com cavidade radical. Ausência de reflexos estapedianos. Quadro compatível com histórico de mastoidectomia e provável recidiva de processo infeccioso (colesteatoma).</p>
            </div>

            <div class="pl-4 border-l-4 border-blue-500">
                <h4 class="font-bold text-blue-800">Orelha Esquerda (OE)</h4>
                <p class="text-gray-800"><strong>Perda Auditiva Condutiva de Grau Leve.</strong></p>
                <p class="text-sm text-gray-600 mt-1">Curva timpanométrica Tipo B (Jerger). Ausência de reflexos estapedianos. Quadro sugestivo de Otite Média Secretora por disfunção tubária.</p>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO E DADOS ---
        const freqs = [250, 500, 1000, 2000, 3000, 4000, 6000, 8000];
        
        // Dados com indicação de mascaramento para o desenho
        // isMaskedVA: boolean array, isMaskedVO: boolean array
        const dataOD = {
            va: [55, 50, 45, 40, 60, 65, 55, 60],
            vo: [null, 25, 20, 30, 35, 45, null, null],
            vaMasked: true, // Usar símbolo de mascaramento na VA
            voMasked: true  // Usar símbolo de mascaramento na VO
        };

        const dataOE = {
            va: [30, 35, 40, 35, 30, 25, 45, 40],
            vo: [null, 10, 15, 5, 15, 15, null, null],
            vaMasked: false, // VA sem mascaramento
            voMasked: true   // VO com mascaramento
        };

        // --- FUNÇÃO DE DESENHO AUDIOGRAMA ---
        function drawAudiogram(canvasId, data, isRight) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            
            // Limpar
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, width, height);

            // Escalas
            const xStep = (width - 2 * padding) / (freqs.length - 1);
            const yStep = (height - 2 * padding) / 13; 

            // Grid
            ctx.beginPath();
            ctx.strokeStyle = "#e5e7eb";
            ctx.lineWidth = 1;
            
            // Frequências
            freqs.forEach((f, i) => {
                const x = padding + i * xStep;
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.fillStyle = "#374151";
                ctx.font = "10px Arial";
                ctx.textAlign = "center";
                ctx.fillText(f >= 1000 ? f/1000 + 'k' : f, x, padding - 10);
            });

            // dB
            for (let db = -10; db <= 120; db += 10) {
                const y = padding + ((db + 10) / 10) * yStep;
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.fillStyle = "#374151";
                ctx.font = "10px Arial";
                ctx.textAlign = "right";
                ctx.fillText(db, padding - 10, y + 3);
            }
            ctx.stroke();

            const color = isRight ? "#dc2626" : "#2563eb"; // Red-600 / Blue-600

            const getX = (i) => padding + i * xStep;
            const getY = (db) => padding + ((db + 10) / 10) * yStep;

            // 1. DESENHAR LINHAS (VA)
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            let first = true;
            data.va.forEach((db, i) => {
                if (db !== null) {
                    const x = getX(i);
                    const y = getY(db);
                    if (first) { ctx.moveTo(x, y); first = false; }
                    else { ctx.lineTo(x, y); }
                }
            });
            ctx.stroke();

            // 2. DESENHAR SÍMBOLOS VA
            data.va.forEach((db, i) => {
                if (db !== null) {
                    const x = getX(i);
                    const y = getY(db);
                    ctx.beginPath();
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    
                    if (isRight) {
                        if (data.vaMasked) {
                            // Triângulo (Mascarado OD)
                            ctx.moveTo(x, y - 5);
                            ctx.lineTo(x + 5, y + 5);
                            ctx.lineTo(x - 5, y + 5);
                            ctx.closePath();
                        } else {
                            // Círculo (Simples OD)
                            ctx.arc(x, y, 4, 0, 2 * Math.PI);
                        }
                    } else {
                        if (data.vaMasked) {
                            // Quadrado (Mascarado OE)
                            ctx.rect(x-4, y-4, 8, 8);
                        } else {
                            // X (Simples OE)
                            ctx.moveTo(x - 4, y - 4);
                            ctx.lineTo(x + 4, y + 4);
                            ctx.moveTo(x + 4, y - 4);
                            ctx.lineTo(x - 4, y + 4);
                        }
                    }
                    ctx.stroke();
                }
            });

            // 3. DESENHAR SÍMBOLOS VO
            data.vo.forEach((db, i) => {
                if (db !== null) {
                    const x = getX(i) + (isRight ? 8 : -8); // Deslocar para não sobrepor
                    const y = getY(db);
                    ctx.beginPath();
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    
                    if (isRight) {
                        if (data.voMasked) {
                            // [ (Mascarado OD)
                            ctx.moveTo(x + 3, y - 6);
                            ctx.lineTo(x - 3, y - 6);
                            ctx.lineTo(x - 3, y + 6);
                            ctx.lineTo(x + 3, y + 6);
                        } else {
                            // < (Simples OD)
                            ctx.moveTo(x + 4, y - 5);
                            ctx.lineTo(x - 2, y);
                            ctx.lineTo(x + 4, y + 5);
                        }
                    } else {
                        if (data.voMasked) {
                            // ] (Mascarado OE)
                            ctx.moveTo(x - 3, y - 6);
                            ctx.lineTo(x + 3, y - 6);
                            ctx.lineTo(x + 3, y + 6);
                            ctx.lineTo(x - 3, y + 6);
                        } else {
                            // > (Simples OE)
                            ctx.moveTo(x - 4, y - 5);
                            ctx.lineTo(x + 2, y);
                            ctx.lineTo(x - 4, y + 5);
                        }
                    }
                    ctx.stroke();
                }
            });
        }

        drawAudiogram('canvasOD', dataOD, true);
        drawAudiogram('canvasOE', dataOE, false);

        // --- FUNÇÃO DE DESENHO TIMPANOMETRIA ---
        function drawTympanogram(canvasId, type, color) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const pX = 30; 
            const pY = 20; 

            // Limpar
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, width, height);

            // Escala e Grid
            const xMin = -400, xMax = 200;
            const yMin = 0, yMax = 2.0;
            const plotW = width - 2 * pX;
            const plotH = height - 2 * pY;

            const mapX = (val) => pX + ((val - xMin) / (xMax - xMin)) * plotW;
            const mapY = (val) => (height - pY) - ((val - yMin) / (yMax - yMin)) * plotH;

            // Grid simples
            ctx.beginPath();
            ctx.strokeStyle = "#f3f4f6";
            ctx.lineWidth = 1;
            for(let p = -400; p <= 200; p += 100) {
                const x = mapX(p);
                ctx.moveTo(x, pY); ctx.lineTo(x, height - pY);
            }
            ctx.stroke();
            
            // Eixos
            ctx.beginPath();
            ctx.strokeStyle = "#9ca3af";
            ctx.moveTo(pX, height - pY); ctx.lineTo(width - pX, height - pY); // X axis
            ctx.moveTo(pX, pY); ctx.lineTo(pX, height - pY); // Y axis
            ctx.stroke();

            // Desenhar Curva
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;

            for (let p = -400; p <= 200; p += 5) {
                let c = 0;
                if (type === 'B') {
                    // Tipo B: Leve ondulação em 0.1-0.2
                    c = 0.15 + Math.sin(p/100) * 0.02;
                } else {
                    // Tipo Aberta: Muito baixo, quase zero
                    c = 0.05 + Math.random() * 0.01;
                }
                
                const x = mapX(p);
                const y = mapY(c);
                if (p === -400) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        drawTympanogram('canvasTympOD', 'Open', '#dc2626');
        drawTympanogram('canvasTympOE', 'B', '#2563eb');

    </script>
</body>
</html>
